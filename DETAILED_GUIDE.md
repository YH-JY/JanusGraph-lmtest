# JanusGraph K8s Platform è¯¦ç»†éƒ¨ç½²ä½¿ç”¨æŒ‡å—

## ğŸš€ é¡¹ç›®æ¦‚è¿°

JanusGraph K8s Platform æ˜¯ä¸€ä¸ªä¸“ä¸ºäº‘åŸç”Ÿç¯å¢ƒè®¾è®¡çš„èµ„äº§ç®¡ç†å’Œæ”»å‡»è·¯å¾„åˆ†æå¹³å°ã€‚è¯¥å¹³å°èƒ½å¤Ÿï¼š

- ğŸ”„ è‡ªåŠ¨æ”¶é›†K8sé›†ç¾¤ä¸­çš„èµ„äº§ä¿¡æ¯
- ğŸ“Š æ„å»ºåŸºäºJanusGraphçš„èµ„äº§å…³ç³»å›¾è°±
- ğŸ¯ å¯è§†åŒ–å±•ç¤ºäº‘åŸç”Ÿæ”»å‡»è·¯å¾„
- ğŸ” å®æ—¶é£é™©è¯„ä¼°å’Œå®‰å…¨åˆ†æ

## ğŸ“‹ ç¯å¢ƒè¦æ±‚

### ç¡¬ä»¶è¦æ±‚
- CPU: 2æ ¸å¿ƒä»¥ä¸Š
- å†…å­˜: 4GBä»¥ä¸Š
- ç¡¬ç›˜: 10GBå¯ç”¨ç©ºé—´

### è½¯ä»¶ä¾èµ–
```bash
# åŸºç¡€ç¯å¢ƒ
Python 3.8+
Node.js 14+
npm 6+
Git

# å¤–éƒ¨æœåŠ¡
JanusGraph å›¾æ•°æ®åº“
Kubernetes é›†ç¾¤è®¿é—®æƒé™
```

### æœåŠ¡è¦æ±‚
- **JanusGraph**: è¿è¡Œåœ¨ `192.168.40.129:8182`
- **Kubernetes**: é›†ç¾¤å¯è®¿é—®ï¼Œé…ç½®æ–‡ä»¶ä½äº `~/.kube/config`

## ğŸ› ï¸ å¿«é€Ÿéƒ¨ç½²

### æ­¥éª¤1: å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/YH-JY/JanusGraph-lmtest.git
cd JanusGraph-lmtest
```

### æ­¥éª¤2: ç¯å¢ƒéªŒè¯
```bash
# æ£€æŸ¥JanusGraphè¿æ¥
curl -s http://192.168.40.129:8182

# æ£€æŸ¥K8sé›†ç¾¤è¿æ¥
kubectl cluster-info

# æ£€æŸ¥é…ç½®æ–‡ä»¶
ls -la ~/.kube/config
```

### æ­¥éª¤3: ä¸€é”®å¯åŠ¨
```bash
chmod +x start.sh
./start.sh
```

### æ­¥éª¤4: è®¿é—®åº”ç”¨
- å‰ç«¯ç•Œé¢: http://localhost:3000
- åç«¯API: http://localhost:5000
- å¥åº·æ£€æŸ¥: http://localhost:5000/api/health

## ğŸ”§ æ‰‹åŠ¨éƒ¨ç½²è¯¦è§£

### åç«¯æœåŠ¡éƒ¨ç½²

#### 1. åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ
```bash
cd backend

# ä½¿ç”¨venvåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate     # Windows
```

#### 2. å®‰è£…Pythonä¾èµ–
```bash
pip install -r requirements.txt
```

#### 3. ç¯å¢ƒé…ç½®
```bash
# å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶
cp .env .env.local

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano .env.local
```

é…ç½®æ–‡ä»¶å†…å®¹ï¼š
```env
# JanusGraphé…ç½®
JANUSGRAPH_HOST=192.168.40.129
JANUSGRAPH_PORT=8182

# K8sé…ç½®
K8S_CONFIG_PATH=~/.kube/config

# Flaské…ç½®
FLASK_ENV=development
FLASK_PORT=5000
```

#### 4. å¯åŠ¨åç«¯æœåŠ¡
```bash
cd src
python app.py
```

### å‰ç«¯åº”ç”¨éƒ¨ç½²

#### 1. å®‰è£…Node.jsä¾èµ–
```bash
cd frontend
npm install
```

#### 2. é…ç½®ä»£ç†ï¼ˆå¦‚éœ€è¦ï¼‰
ç¼–è¾‘ `package.json` æ–‡ä»¶ä¸­çš„ä»£ç†é…ç½®ï¼š
```json
{
  "proxy": "http://localhost:5000"
}
```

#### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
npm start
```

#### 4. ç”Ÿäº§ç¯å¢ƒæ„å»ºï¼ˆå¯é€‰ï¼‰
```bash
npm run build
# æ„å»ºç»“æœåœ¨ build/ ç›®å½•
```

## ğŸ“Š åŠŸèƒ½ä½¿ç”¨æŒ‡å—

### 1. ä»ªè¡¨æ¿æ¦‚è§ˆ

#### ä¸»è¦åŠŸèƒ½
- **å®æ—¶ç›‘æ§**: æ˜¾ç¤ºé›†ç¾¤èµ„æºç»Ÿè®¡
- **é£é™©æŒ‡æ ‡**: å¯è§†åŒ–å®‰å…¨é£é™©ç­‰çº§
- **å¿«é€Ÿæ“ä½œ**: ä¸€é”®æ‰§è¡Œå®Œæ•´æµç¨‹

#### ä½¿ç”¨æ­¥éª¤
1. è®¿é—® http://localhost:3000
2. æŸ¥çœ‹"ä»ªè¡¨æ¿"é¡µé¢
3. ç›‘æ§å„é¡¹ç»Ÿè®¡æŒ‡æ ‡
4. ç‚¹å‡»"æ‰§è¡Œå®Œæ•´æµç¨‹"å¼€å§‹åˆ†æ

### 2. K8sæ•°æ®æ”¶é›†

#### æ“ä½œæµç¨‹
1. è¿›å…¥"K8sæ•°æ®æ”¶é›†"é¡µé¢
2. é€‰æ‹©ç›®æ ‡å‘½åç©ºé—´ï¼ˆå¯é€‰ï¼‰
3. ç‚¹å‡»"å¼€å§‹æ”¶é›†æ•°æ®"
4. ç­‰å¾…æ•°æ®æ”¶é›†å®Œæˆ
5. ç‚¹å‡»"æ„å»ºå›¾æ•°æ®åº“"

#### æ•°æ®ç±»å‹
- **å‘½åç©ºé—´**: K8så‘½åç©ºé—´ä¿¡æ¯
- **Pod**: å®¹å™¨ç»„è¯¦ç»†ä¿¡æ¯
- **æœåŠ¡**: ç½‘ç»œæœåŠ¡é…ç½®
- **éƒ¨ç½²**: åº”ç”¨éƒ¨ç½²é…ç½®
- **é›†ç¾¤è§’è‰²**: RBACæƒé™é…ç½®

### 3. å›¾è°±å¯è§†åŒ–

#### å¯è§†åŒ–ç‰¹æ€§
- **åŠ›å¯¼å‘å›¾**: è‡ªåŠ¨å¸ƒå±€çš„èŠ‚ç‚¹å…³ç³»å›¾
- **äº¤äº’æ“ä½œ**: æ”¯æŒæ‹–æ‹½ã€ç¼©æ”¾ã€ç­›é€‰
- **èŠ‚ç‚¹åˆ†ç±»**: ä¸åŒç±»å‹èŠ‚ç‚¹é¢œè‰²åŒºåˆ†
- **é£é™©æ ‡æ³¨**: é«˜é£é™©èŠ‚ç‚¹ç‰¹åˆ«æ ‡è®°

#### æ“ä½œæŒ‡å—
1. ç‚¹å‡»"å›¾è°±å¯è§†åŒ–"é¡µé¢
2. ä½¿ç”¨é¼ æ ‡æ‹–æ‹½èŠ‚ç‚¹è°ƒæ•´ä½ç½®
3. æ»šè½®ç¼©æ”¾è§†å›¾
4. é€‰æ‹©å‘½åç©ºé—´è¿‡æ»¤èŠ‚ç‚¹
5. ç‚¹å‡»èŠ‚ç‚¹æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯

#### èŠ‚ç‚¹å›¾ä¾‹
- ğŸŸ¦ **Namespace**: å‘½åç©ºé—´ï¼ˆè“è‰²ï¼‰
- ğŸŸ© **Pod**: å®¹å™¨ç»„ï¼ˆç»¿è‰²ï¼‰
- ğŸŸ¨ **Service**: æœåŠ¡ï¼ˆé»„è‰²ï¼‰
- ğŸŸª **Deployment**: éƒ¨ç½²ï¼ˆç´«è‰²ï¼‰
- ğŸŸ¥ **ClusterRole**: é›†ç¾¤è§’è‰²ï¼ˆçº¢è‰²ï¼‰

### 4. æ”»å‡»è·¯å¾„åˆ†æ

#### åˆ†æåŠŸèƒ½
- **è·¯å¾„æœç´¢**: è‡ªå®šä¹‰èµ·ç‚¹å’Œç»ˆç‚¹ç±»å‹
- **é£é™©è¯„ä¼°**: è‡ªåŠ¨è®¡ç®—è·¯å¾„é£é™©ç­‰çº§
- **è¯¦ç»†åˆ†æ**: æŸ¥çœ‹å®Œæ•´æ”»å‡»æ—¶åº
- **ç»Ÿè®¡æŠ¥å‘Š**: ç”Ÿæˆå®‰å…¨è¯„ä¼°æŠ¥å‘Š

#### ä½¿ç”¨æ­¥éª¤
1. è¿›å…¥"æ”»å‡»è·¯å¾„åˆ†æ"é¡µé¢
2. è®¾ç½®æœç´¢æ¡ä»¶ï¼š
   - èµ·å§‹èŠ‚ç‚¹ç±»å‹ï¼ˆå¦‚ï¼šPodï¼‰
   - ç›®æ ‡èŠ‚ç‚¹ç±»å‹ï¼ˆå¦‚ï¼šClusterRoleï¼‰
   - æœ€å¤§è·¯å¾„æ·±åº¦
3. ç‚¹å‡»"æœç´¢è·¯å¾„"
4. æŸ¥çœ‹æœç´¢ç»“æœ
5. ç‚¹å‡»"æŸ¥çœ‹è¯¦æƒ…"åˆ†æå…·ä½“è·¯å¾„

#### é£é™©ç­‰çº§
- ğŸ”´ **High**: é«˜é£é™©ï¼Œç«‹å³å¤„ç†
- ğŸŸ  **Medium**: ä¸­é£é™©ï¼Œè®¡åˆ’å¤„ç†
- ğŸŸ¢ **Low**: ä½é£é™©ï¼ŒæŒç»­ç›‘æ§

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. JanusGraphè¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://192.168.40.129:8182

# æ£€æŸ¥é˜²ç«å¢™
telnet 192.168.40.129 8182

# æŸ¥çœ‹JanusGraphæ—¥å¿—
docker logs [janusgraph_container_name]
```

#### 2. K8sæƒé™é—®é¢˜
```bash
# éªŒè¯é…ç½®æ–‡ä»¶
kubectl config view

# æµ‹è¯•é›†ç¾¤è®¿é—®
kubectl get nodes

# æ£€æŸ¥æƒé™
kubectl auth can-i get pods
```

#### 3. åç«¯æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 5000

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
python app.py --debug

# é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt --force-reinstall
```

#### 4. å‰ç«¯ç¼–è¯‘é”™è¯¯
```bash
# æ¸…ç†ç¼“å­˜
npm cache clean --force

# åˆ é™¤node_modulesé‡è£…
rm -rf node_modules package-lock.json
npm install

# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version  # å»ºè®® >= 14.x
```

### æ—¥å¿—æŸ¥çœ‹

#### åç«¯æ—¥å¿—
```bash
# å¼€å‘æ¨¡å¼æ—¥å¿—ç›´æ¥åœ¨ç»ˆç«¯æ˜¾ç¤º

# ç”Ÿäº§æ¨¡å¼æ—¥å¿—ï¼ˆå¦‚é…ç½®ï¼‰
tail -f /var/log/janusgraph-platform/app.log
```

#### å‰ç«¯æ—¥å¿—
- æµè§ˆå™¨å¼€å‘è€…å·¥å…· > Console
- å¼€å‘æœåŠ¡å™¨ç»ˆç«¯è¾“å‡º

#### K8sæ—¥å¿—
```bash
# æŸ¥çœ‹é›†ç¾¤äº‹ä»¶
kubectl get events --sort-by=.metadata.creationTimestamp

# æŸ¥çœ‹Podæ—¥å¿—
kubectl logs -f [pod_name] -n [namespace]
```

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### åç«¯æœåŠ¡ä¼˜åŒ–

#### 1. ä½¿ç”¨Gunicorn
```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 app:app
```

#### 2. é…ç½®Nginxåå‘ä»£ç†
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location /api {
        proxy_pass http://localhost:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location / {
        root /path/to/frontend/build;
        try_files $uri $uri/ /index.html;
    }
}
```

#### 3. ç³»ç»ŸæœåŠ¡é…ç½®
```bash
# åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶
sudo nano /etc/systemd/system/janusgraph-platform.service
```

```ini
[Unit]
Description=JanusGraph K8s Platform Backend
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/opt/janusgraph-platform/backend
Environment=PATH=/opt/janusgraph-platform/backend/venv/bin
ExecStart=/opt/janusgraph-platform/backend/venv/bin/python app.py
Restart=always

[Install]
WantedBy=multi-user.target
```

### å‰ç«¯ç”Ÿäº§æ„å»º
```bash
# æ„å»ºä¼˜åŒ–ç‰ˆæœ¬
npm run build

# é…ç½®WebæœåŠ¡å™¨ï¼ˆApache/Nginxï¼‰
# å¯ç”¨Gzipå‹ç¼©
# é…ç½®ç¼“å­˜ç­–ç•¥
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®æ”¶é›†ä¼˜åŒ–
- ä½¿ç”¨å‘½åç©ºé—´è¿‡æ»¤å‡å°‘æ•°æ®é‡
- åˆ†æ‰¹å¤„ç†å¤§è§„æ¨¡é›†ç¾¤
- å®ç°å¢é‡æ•°æ®æ›´æ–°

### å¯è§†åŒ–ä¼˜åŒ–
- é™åˆ¶æ˜¾ç¤ºèŠ‚ç‚¹æ•°é‡ï¼ˆæœ€å¤§1000ä¸ªï¼‰
- ä½¿ç”¨æ•°æ®èšåˆå‡å°‘æ¸²æŸ“è´Ÿè½½
- å®ç°æ‡’åŠ è½½æœºåˆ¶

### æŸ¥è¯¢ä¼˜åŒ–
- æ·»åŠ å›¾æ•°æ®åº“ç´¢å¼•
- ä½¿ç”¨GremlinæŸ¥è¯¢ä¼˜åŒ–
- å®ç°æŸ¥è¯¢ç»“æœç¼“å­˜

## ğŸ”’ å®‰å…¨é…ç½®

### ç½‘ç»œå®‰å…¨
- å¯ç”¨HTTPS/TLSåŠ å¯†
- é…ç½®é˜²ç«å¢™è§„åˆ™
- é™åˆ¶APIè®¿é—®é¢‘ç‡

### æ•°æ®å®‰å…¨
- æ•æ„Ÿä¿¡æ¯è„±æ•
- å®ç°è®¿é—®æ—¥å¿—å®¡è®¡
- å®šæœŸå¤‡ä»½æ•°æ®åº“

### è®¤è¯æˆæƒ
- æ·»åŠ ç”¨æˆ·è®¤è¯æ¨¡å—
- å®ç°è§’è‰²æƒé™æ§åˆ¶
- é…ç½®OAuth2é›†æˆ

## ğŸ“ æ›´æ–°ç»´æŠ¤

### ç‰ˆæœ¬æ›´æ–°
```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin master

# æ›´æ–°åç«¯ä¾èµ–
pip install -r requirements.txt --upgrade

# æ›´æ–°å‰ç«¯ä¾èµ–
npm update

# é‡å¯æœåŠ¡
./restart.sh
```

### æ•°æ®å¤‡ä»½
```bash
# å¤‡ä»½JanusGraphæ•°æ®
# å‚è€ƒJanusGraphå¤‡ä»½æ–‡æ¡£

# å¤‡ä»½é…ç½®æ–‡ä»¶
tar -czf config-backup.tar.gz backend/.env
```

### ç›‘æ§å‘Šè­¦
- è®¾ç½®æœåŠ¡å¥åº·æ£€æŸ¥
- é…ç½®é”™è¯¯é˜ˆå€¼å‘Šè­¦
- å®ç°è‡ªåŠ¨æ•…éšœæ¢å¤

## ğŸ¤ æŠ€æœ¯æ”¯æŒ

### é—®é¢˜åé¦ˆ
- æäº¤Issue: https://github.com/YH-JY/JanusGraph-lmtest/issues
- æŸ¥çœ‹Wiki: https://github.com/YH-JY/JanusGraph-lmtest/wiki

### ç¤¾åŒºäº¤æµ
- é¡¹ç›®ä¸»é¡µ: https://github.com/YH-JY/JanusGraph-lmtest
- æ–‡æ¡£åœ°å€: https://github.com/YH-JY/JanusGraph-lmtest/docs

---

**æ³¨æ„**: æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œå®éªŒä½¿ç”¨ï¼Œè¯·åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è°¨æ…ä½¿ç”¨ã€‚